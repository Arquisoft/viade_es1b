{"ast":null,"code":"import _regeneratorRuntime from \"c:\\\\Users\\\\alber\\\\Desktop\\\\ejemplo\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"c:\\\\Users\\\\alber\\\\Desktop\\\\ejemplo\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"c:\\\\Users\\\\alber\\\\Desktop\\\\ejemplo\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"c:\\\\Users\\\\alber\\\\Desktop\\\\ejemplo\\\\src\\\\containers\\\\TextEditor\\\\text-editor.component.js\";\n\n/* eslint-disable constructor-super */\n\n/* eslint-disable no-nested-ternary */\n\n/* eslint-disable no-console */\nimport React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport SolidAuth from 'solid-auth-client';\nimport { successToaster, errorToaster } from \"../../utils\";\nimport ldflex from '@solid/query-ldflex';\nimport { AccessControlList } from '@inrupt/solid-react-components';\nimport { TextEditorWrapper, TextEditorContainer, Header, Form, FullGridSize, Button, Label, Input, TextArea, WebId } from \"./text-editor.style\";\n\nfunction extractWacAllow(response) {\n  // WAC-Allow: user=\"read write append control\",public=\"read\"\n  var modes = {\n    user: {\n      read: false,\n      append: false,\n      write: false,\n      control: false\n    },\n    public: {\n      read: false,\n      append: false,\n      write: false,\n      control: false\n    }\n  };\n  var wacAllowHeader = response.headers.get('WAC-Allow');\n\n  if (wacAllowHeader) {\n    wacAllowHeader // 'user=\"read write append control\",public=\"read\"'\n    .split(',') // ['user=\"read write append control\"', 'public=\"read\"']\n    .map(function (str) {\n      return str.trim();\n    }).forEach(function (statement) {\n      // 'user=\"read write append control\"'\n      var parts = statement.split('='); // ['user', '\"read write control\"']\n\n      if (parts.length >= 2 && ['user', 'public'].indexOf(parts[0]) !== -1 && parts[1].length > 2) {\n        var modeStr = parts[1].replace(/\"/g, ''); // 'read write control' or ''\n\n        if (modeStr.length) {\n          modeStr.split(' ').forEach(function (mode) {\n            modes[parts[0]][mode] = true;\n          });\n        }\n      }\n    });\n  }\n\n  return modes;\n}\n\nexport var Editor = function Editor(_ref) {\n  var webId = _ref.webId;\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      url = _useState2[0],\n      setUrl = _useState2[1];\n\n  var _useState3 = useState('https://example-friend.com/profile/card#me'),\n      _useState4 = _slicedToArray(_useState3, 2),\n      friend = _useState4[0],\n      setFriend = _useState4[1];\n\n  var _useState5 = useState(''),\n      _useState6 = _slicedToArray(_useState5, 2),\n      text = _useState6[0],\n      setText = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      loaded = _useState8[0],\n      setLoaded = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      editable = _useState10[0],\n      setEditable = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      sharable = _useState12[0],\n      setSharable = _useState12[1];\n\n  function setUrlFromStorage() {\n    return _setUrlFromStorage.apply(this, arguments);\n  }\n\n  function _setUrlFromStorage() {\n    _setUrlFromStorage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var storageRoot, exampleUrl;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(webId && !url)) {\n                _context2.next = 5;\n                break;\n              }\n\n              _context2.next = 3;\n              return ldflex[webId]['pim:storage'];\n\n            case 3:\n              storageRoot = _context2.sent;\n\n              if (storageRoot) {\n                exampleUrl = new URL('/share/some-doc.txt', storageRoot.value);\n                setUrl(exampleUrl);\n              }\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return _setUrlFromStorage.apply(this, arguments);\n  }\n\n  useEffect(function () {\n    setUrlFromStorage();\n  }, [webId]);\n\n  function handleUrlChange(event) {\n    event.preventDefault();\n    setUrl(event.target.value);\n  }\n\n  function handleFriendChange(event) {\n    event.preventDefault();\n    setFriend(event.target.value);\n  }\n\n  function handleTextChange(event) {\n    event.preventDefault();\n    setText(event.target.value);\n  }\n\n  function handleLoad(event) {\n    event.preventDefault();\n    var doc = SolidAuth.fetch(url);\n    doc.then( /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n        var text, wacAllowModes;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return response.text();\n\n              case 2:\n                text = _context.sent;\n\n                if (response.ok) {\n                  setText(text);\n                } else if (response.status === 404) {\n                  successToaster(t('notifications.404'));\n                } else {\n                  errorToaster(t('notifications.errorLoading'));\n                }\n\n                wacAllowModes = extractWacAllow(response);\n                setEditable(wacAllowModes.user.write);\n                setSharable(wacAllowModes.user.control);\n                setLoaded(true);\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }()).catch(function () {\n      errorToaster(t('notifications.errorFetching'));\n    });\n  } // assuming the logged in user doesn't change without a page refresh\n\n\n  function handleShare(_x2) {\n    return _handleShare.apply(this, arguments);\n  }\n\n  function _handleShare() {\n    _handleShare = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(event) {\n      var permissions, ACLFile;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              event.preventDefault();\n              _context3.prev = 1;\n              permissions = [{\n                agents: [friend],\n                modes: [AccessControlList.MODES.READ, AccessControlList.MODES.WRITE]\n              }];\n              ACLFile = new AccessControlList(webId, url);\n              _context3.next = 6;\n              return ACLFile.createACL(permissions);\n\n            case 6:\n              successToaster(t('notifications.accessGranted'));\n              _context3.next = 12;\n              break;\n\n            case 9:\n              _context3.prev = 9;\n              _context3.t0 = _context3[\"catch\"](1);\n              errorToaster(t('notifications.errorGrantingAccess'));\n\n            case 12:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[1, 9]]);\n    }));\n    return _handleShare.apply(this, arguments);\n  }\n\n  function handleSave(_x3) {\n    return _handleSave.apply(this, arguments);\n  }\n\n  function _handleSave() {\n    _handleSave = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(event) {\n      var result;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              event.preventDefault(); // Not using LDFlex here, because this is not an RDF document.\n\n              _context4.next = 3;\n              return SolidAuth.fetch(url, {\n                method: 'PUT',\n                body: text,\n                headers: {\n                  'Content-Type': 'text/plain'\n                }\n              });\n\n            case 3:\n              result = _context4.sent;\n\n              if (result.ok) {\n                successToaster(t('notifications.saved'));\n              } else if (result.ok === false) {\n                errorToaster(t('notifications.errorSaving'));\n              }\n\n            case 5:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n    return _handleSave.apply(this, arguments);\n  }\n\n  return React.createElement(Form, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }, React.createElement(FullGridSize, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }, React.createElement(WebId, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }, React.createElement(\"b\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167\n    },\n    __self: this\n  }, \"Connected as: \", React.createElement(\"a\", {\n    href: webId,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168\n    },\n    __self: this\n  }, webId)))), React.createElement(FullGridSize, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172\n    },\n    __self: this\n  }, React.createElement(Label, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173\n    },\n    __self: this\n  }, t('editor.url'), \":\", React.createElement(Input, {\n    type: \"text\",\n    size: \"200\",\n    value: url,\n    onChange: handleUrlChange,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"input-wrap\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177\n    },\n    __self: this\n  }, React.createElement(Button, {\n    className: \"ids-link-filled ids-link-filled--primary button\",\n    onClick: handleLoad,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178\n    },\n    __self: this\n  }, t('editor.load')), editable ? React.createElement(Button, {\n    className: \"ids-link-filled ids-link-filled--secondary button\",\n    onClick: handleSave,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182\n    },\n    __self: this\n  }, t('editor.save')) : loaded ? t('notifications.notEditable') : '')), React.createElement(FullGridSize, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195\n    },\n    __self: this\n  }, React.createElement(TextArea, {\n    value: text,\n    onChange: handleTextChange,\n    cols: 40,\n    rows: 10,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196\n    },\n    __self: this\n  })), sharable && React.createElement(FullGridSize, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199\n    },\n    __self: this\n  }, React.createElement(Label, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200\n    },\n    __self: this\n  }, t('editor.friend'), \":\", React.createElement(Input, {\n    type: \"text\",\n    size: \"200\",\n    value: friend,\n    onChange: handleFriendChange,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202\n    },\n    __self: this\n  })), React.createElement(Button, {\n    className: \"ids-link-stroke ids-link-stroke--primary button\",\n    onClick: handleShare,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204\n    },\n    __self: this\n  }, t('editor.grantAccess'))), loaded && !sharable && t('notifications.notSharable'));\n};\n/**\n * A React component page that is displayed when there's no valid route. Users can click the button\n * to get back to the home/welcome page.\n */\n\nvar TextEditor = function TextEditor(_ref3) {\n  var webId = _ref3.webId;\n\n  var _useTranslation2 = useTranslation(),\n      t = _useTranslation2.t;\n\n  console.log(webId);\n  return React.createElement(TextEditorWrapper, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222\n    },\n    __self: this\n  }, React.createElement(TextEditorContainer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223\n    },\n    __self: this\n  }, React.createElement(Header, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224\n    },\n    __self: this\n  }, React.createElement(\"p\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225\n    },\n    __self: this\n  }, t('editor.explanation'))), React.createElement(Editor, {\n    webId: webId,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227\n    },\n    __self: this\n  })));\n};\n\nexport default TextEditor;","map":{"version":3,"sources":["c:/Users/alber/Desktop/ejemplo/src/containers/TextEditor/text-editor.component.js"],"names":["React","useState","useEffect","useTranslation","SolidAuth","successToaster","errorToaster","ldflex","AccessControlList","TextEditorWrapper","TextEditorContainer","Header","Form","FullGridSize","Button","Label","Input","TextArea","WebId","extractWacAllow","response","modes","user","read","append","write","control","public","wacAllowHeader","headers","get","split","map","str","trim","forEach","statement","parts","length","indexOf","modeStr","replace","mode","Editor","webId","t","url","setUrl","friend","setFriend","text","setText","loaded","setLoaded","editable","setEditable","sharable","setSharable","setUrlFromStorage","storageRoot","exampleUrl","URL","value","handleUrlChange","event","preventDefault","target","handleFriendChange","handleTextChange","handleLoad","doc","fetch","then","ok","status","wacAllowModes","catch","handleShare","permissions","agents","MODES","READ","WRITE","ACLFile","createACL","handleSave","method","body","result","TextEditor","console","log"],"mappings":"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","sourcesContent":["/* eslint-disable constructor-super */\n/* eslint-disable no-nested-ternary */\n/* eslint-disable no-console */\n\nimport React, { useState, useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport SolidAuth from 'solid-auth-client';\nimport { successToaster, errorToaster } from '@utils';\nimport ldflex from '@solid/query-ldflex';\nimport { AccessControlList } from '@inrupt/solid-react-components';\nimport {\n  TextEditorWrapper,\n  TextEditorContainer,\n  Header,\n  Form,\n  FullGridSize,\n  Button,\n  Label,\n  Input,\n  TextArea,\n  WebId\n} from './text-editor.style';\n\ntype Props = { webId: String };\n\nfunction extractWacAllow(response) {\n  // WAC-Allow: user=\"read write append control\",public=\"read\"\n  const modes = {\n    user: {\n      read: false,\n      append: false,\n      write: false,\n      control: false\n    },\n    public: {\n      read: false,\n      append: false,\n      write: false,\n      control: false\n    }\n  };\n  const wacAllowHeader = response.headers.get('WAC-Allow');\n  if (wacAllowHeader) {\n    wacAllowHeader // 'user=\"read write append control\",public=\"read\"'\n      .split(',') // ['user=\"read write append control\"', 'public=\"read\"']\n      .map(str => str.trim())\n      .forEach(statement => {\n        // 'user=\"read write append control\"'\n        const parts = statement.split('='); // ['user', '\"read write control\"']\n        if (\n          parts.length >= 2 &&\n          ['user', 'public'].indexOf(parts[0]) !== -1 &&\n          parts[1].length > 2\n        ) {\n          const modeStr = parts[1].replace(/\"/g, ''); // 'read write control' or ''\n          if (modeStr.length) {\n            modeStr.split(' ').forEach(mode => {\n              modes[parts[0]][mode] = true;\n            });\n          }\n        }\n      });\n  }\n  return modes;\n}\n\nexport const Editor = ({ webId }: Props) => {\n  const { t } = useTranslation();\n  const [url, setUrl] = useState('');\n  const [friend, setFriend] = useState('https://example-friend.com/profile/card#me');\n  const [text, setText] = useState('');\n  const [loaded, setLoaded] = useState(false);\n  const [editable, setEditable] = useState(false);\n  const [sharable, setSharable] = useState(false);\n\n  async function setUrlFromStorage() {\n    if (webId && !url) {\n      const storageRoot = await ldflex[webId]['pim:storage'];\n      if (storageRoot) {\n        const exampleUrl = new URL('/share/some-doc.txt', storageRoot.value);\n        setUrl(exampleUrl);\n      }\n    }\n  }\n\n  useEffect(() => {\n    setUrlFromStorage();\n  }, [webId]);\n\n  function handleUrlChange(event) {\n    event.preventDefault();\n    setUrl(event.target.value);\n  }\n\n  function handleFriendChange(event) {\n    event.preventDefault();\n    setFriend(event.target.value);\n  }\n\n  function handleTextChange(event) {\n    event.preventDefault();\n    setText(event.target.value);\n  }\n\n  function handleLoad(event) {\n    event.preventDefault();\n    const doc = SolidAuth.fetch(url);\n    doc\n      .then(async response => {\n        const text = await response.text();\n        if (response.ok) {\n          setText(text);\n        } else if (response.status === 404) {\n          successToaster(t('notifications.404'));\n        } else {\n          errorToaster(t('notifications.errorLoading'));\n        }\n        const wacAllowModes = extractWacAllow(response);\n        setEditable(wacAllowModes.user.write);\n        setSharable(wacAllowModes.user.control);\n        setLoaded(true);\n      })\n      .catch(() => {\n        errorToaster(t('notifications.errorFetching'));\n      });\n  } // assuming the logged in user doesn't change without a page refresh\n\n  async function handleShare(event) {\n    event.preventDefault();\n    try {\n      const permissions = [\n        {\n          agents: [friend],\n          modes: [AccessControlList.MODES.READ, AccessControlList.MODES.WRITE]\n        }\n      ];\n      const ACLFile = new AccessControlList(webId, url);\n      await ACLFile.createACL(permissions);\n      successToaster(t('notifications.accessGranted'));\n    } catch (e) {\n      errorToaster(t('notifications.errorGrantingAccess'));\n    }\n  }\n\n  async function handleSave(event) {\n    event.preventDefault();\n    // Not using LDFlex here, because this is not an RDF document.\n    const result = await SolidAuth.fetch(url, {\n      method: 'PUT',\n      body: text,\n      headers: {\n        'Content-Type': 'text/plain'\n      }\n    });\n\n    if (result.ok) {\n      successToaster(t('notifications.saved'));\n    } else if (result.ok === false) {\n      errorToaster(t('notifications.errorSaving'));\n    }\n  }\n\n  return (\n    <Form>\n      <FullGridSize>\n        <WebId>\n          <b>\n            Connected as: <a href={webId}>{webId}</a>\n          </b>\n        </WebId>\n      </FullGridSize>\n      <FullGridSize>\n        <Label>\n          {t('editor.url')}:\n          <Input type=\"text\" size=\"200\" value={url} onChange={handleUrlChange} />\n        </Label>\n        <div className=\"input-wrap\">\n          <Button className=\"ids-link-filled ids-link-filled--primary button\" onClick={handleLoad}>\n            {t('editor.load')}\n          </Button>\n          {editable ? (\n            <Button\n              className=\"ids-link-filled ids-link-filled--secondary button\"\n              onClick={handleSave}\n            >\n              {t('editor.save')}\n            </Button>\n          ) : loaded ? (\n            t('notifications.notEditable')\n          ) : (\n            ''\n          )}\n        </div>\n      </FullGridSize>\n      <FullGridSize>\n        <TextArea value={text} onChange={handleTextChange} cols={40} rows={10} />\n      </FullGridSize>\n      {sharable && (\n        <FullGridSize>\n          <Label>\n            {t('editor.friend')}:\n            <Input type=\"text\" size=\"200\" value={friend} onChange={handleFriendChange} />\n          </Label>\n          <Button className=\"ids-link-stroke ids-link-stroke--primary button\" onClick={handleShare}>\n            {t('editor.grantAccess')}\n          </Button>\n        </FullGridSize>\n      )}\n      {loaded && !sharable && t('notifications.notSharable')}\n    </Form>\n  );\n};\n\n/**\n * A React component page that is displayed when there's no valid route. Users can click the button\n * to get back to the home/welcome page.\n */\nconst TextEditor = ({ webId }: Props) => {\n  const { t } = useTranslation();\n  console.log(webId);\n  return (\n    <TextEditorWrapper>\n      <TextEditorContainer>\n        <Header>\n          <p>{t('editor.explanation')}</p>\n        </Header>\n        <Editor webId={webId} />\n      </TextEditorContainer>\n    </TextEditorWrapper>\n  );\n};\n\nexport default TextEditor;\n"]},"metadata":{},"sourceType":"module"}